{% extends "base.html" %}
{% block title %}Notifikasi - {{ app_name }}{% endblock %}

{% block content %}
<div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-800"><i class="fas fa-bell text-blue-500 mr-2"></i>Notifikasi</h2>
    <p class="text-gray-500 text-sm mt-1">Semua notifikasi Anda</p>
</div>

<div class="bg-white rounded-xl shadow-sm border overflow-hidden">
    <div class="divide-y">
        {% for n in notifications %}
        <a href="{{ n.link or '#' }}" onclick="markNotifRead({{ n.id }}, event)" class="block px-5 py-4 hover:bg-gray-50 transition {{ 'opacity-60' if n.is_read }}">
            <div class="flex items-start gap-3">
                <div class="flex-shrink-0 mt-1">
                    <div class="w-3 h-3 rounded-full {{ 'bg-gray-300' if n.is_read else 'bg-blue-500' }}"></div>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-gray-800">{{ n.title }}</p>
                    <p class="text-sm text-gray-600 mt-0.5">{{ n.message }}</p>
                    <p class="text-xs text-gray-400 mt-1"><i class="fas fa-clock mr-1"></i>{{ n.created_at }}</p>
                </div>
            </div>
        </a>
        {% else %}
        <div class="px-5 py-12 text-center">
            <div class="text-gray-400">
                <i class="fas fa-bell-slash text-4xl mb-3"></i>
                <p class="text-lg font-medium">Belum ada notifikasi</p>
                <p class="text-sm mt-1">Notifikasi akan muncul saat ada perubahan pada surat</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function markNotifRead(id, event) {
    if (event) event.preventDefault();
    const link = event ? event.currentTarget.href : null;
    const csrfMeta = document.querySelector('meta[name="csrf-token"]');
    const headers = {'Content-Type': 'application/json'};
    if (csrfMeta) headers['X-CSRFToken'] = csrfMeta.content;
    fetch(`/api/notifications/${id}/read`, {method: 'POST', headers: headers})
        .finally(() => {
            if (link && link !== '#') window.location.href = link;
            else window.location.reload();
        });
}
</script>
{% endblock %}
