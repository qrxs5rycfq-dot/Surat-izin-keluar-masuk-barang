<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<style>
    @page { size: A4 landscape; margin: 12mm 15mm; }
    body { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 9pt; color: #1a1a1a; margin: 0; }
    .header { text-align: center; border-bottom: 3px solid #1e40af; padding-bottom: 10px; margin-bottom: 14px; }
    .header h1 { font-size: 14pt; margin: 0; color: #1e40af; }
    .header p { font-size: 9pt; color: #666; margin: 4px 0 0; }
    .stats { display: flex; gap: 12px; margin-bottom: 14px; }
    .stat-box { flex: 1; background: #f0f5ff; border: 1px solid #bfdbfe; border-radius: 6px; padding: 10px; text-align: center; }
    .stat-box .val { font-size: 18pt; font-weight: bold; color: #1e40af; }
    .stat-box .lbl { font-size: 7.5pt; color: #6b7280; text-transform: uppercase; }
    table { width: 100%; border-collapse: collapse; }
    th { background: #1e40af; color: #fff; font-size: 7pt; text-transform: uppercase; padding: 5px 6px; text-align: left; }
    td { padding: 4px 6px; border-bottom: 1px solid #e5e7eb; font-size: 8pt; }
    tr:nth-child(even) td { background: #f9fafb; }
    .footer { text-align: center; font-size: 7pt; color: #9ca3af; margin-top: 14px; border-top: 1px solid #e5e7eb; padding-top: 6px; }
    .badge { display: inline-block; padding: 1px 6px; border-radius: 8px; font-size: 6.5pt; font-weight: bold; }
    .b-k { background: #fee2e2; color: #dc2626; }
    .b-m { background: #dcfce7; color: #16a34a; }
    .b-a { background: #dcfce7; color: #16a34a; }
    .b-p { background: #fef3c7; color: #d97706; }
    .b-r { background: #fee2e2; color: #dc2626; }
    .b-rv { background: #dbeafe; color: #2563eb; }
    .stamp-ok { color: #16a34a; font-weight: bold; font-size: 7pt; }
    .stamp-no { color: #dc2626; font-weight: bold; font-size: 7pt; }
</style>
</head>
<body>
<div class="header">
    <h1>LAPORAN BARANG MASUK & KELUAR</h1>
    <p>PT PLN Indonesia Power &mdash; UBP Jawa Tengah 2 Adipala</p>
</div>

<div class="stats">
    <div class="stat-box"><div class="val">{{ total_keluar }}</div><div class="lbl">Surat Keluar</div></div>
    <div class="stat-box"><div class="val">{{ total_masuk }}</div><div class="lbl">Surat Masuk</div></div>
    <div class="stat-box"><div class="val">{{ total_barang }}</div><div class="lbl">Total Item Barang</div></div>
</div>

<table>
    <thead>
        <tr>
            <th>No</th>
            <th>Jenis</th>
            <th>No. Surat</th>
            <th>Tanggal</th>
            <th>Pemohon</th>
            <th>Perusahaan</th>
            <th>Nama Barang</th>
            <th>Jml</th>
            <th>Satuan</th>
            <th>Keterangan</th>
            <th>Foto</th>
            <th>Cek User</th>
            <th>Cek Satpam</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td style="text-align:center">{{ loop.index }}</td>
            <td style="text-align:center"><span class="badge {{ 'b-k' if item.jenis=='keluar' else 'b-m' }}">{{ item.jenis | upper }}</span></td>
            <td>{{ item.no_surat }}</td>
            <td>{{ item.tanggal }}</td>
            <td>{{ item.nama_pemohon }}</td>
            <td>{{ item.perusahaan }}</td>
            <td style="font-weight:bold">{{ item.nama_barang }}</td>
            <td style="text-align:center">{{ item.jumlah }}</td>
            <td style="text-align:center">{{ item.satuan }}</td>
            <td>{{ item.keterangan or '-' }}</td>
            <td style="text-align:center">
                {% if item.foto %}
                {% for f in item.foto %}
                <img src="file://{{ upload_dir }}/{{ f }}" style="max-height:30px;max-width:35px;border-radius:2px;margin:1px;" alt="">
                {% endfor %}
                {% else %}-{% endif %}
            </td>
            <td style="text-align:center">
                {% if item.approval_user == 'sesuai' %}
                <span class="stamp-ok">✓</span>
                {% elif item.approval_user == 'tidak_sesuai' %}
                <span class="stamp-no">✗</span>
                {% else %}-{% endif %}
            </td>
            <td style="text-align:center">
                {% if item.approval_satpam == 'sesuai' %}
                <span class="stamp-ok">✓</span>
                {% elif item.approval_satpam == 'tidak_sesuai' %}
                <span class="stamp-no">✗</span>
                {% else %}-{% endif %}
            </td>
            <td style="text-align:center">
                <span class="badge {{ 'b-a' if item.status=='approved' else ('b-p' if item.status=='pending' else ('b-rv' if item.status=='review' else 'b-r')) }}">{{ item.status | upper }}</span>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="footer">Dicetak pada: {{ now.strftime('%d/%m/%Y %H:%M') }} | PT PLN Indonesia Power | Total: {{ total_barang }} item barang</div>
</body>
</html>
